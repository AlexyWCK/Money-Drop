<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Money Drop - Partie Multijoueur</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='cinematic.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='resolution.css') }}" />
</head>
<body class="md-bg">
  <!-- Overlay cinÃ©matique -->
  <div id="cineOverlay" class="cine-overlay" aria-hidden="true"></div>

  <div class="md-ambient" aria-hidden="true">
    <div class="md-blob md-blob-a"></div>
    <div class="md-blob md-blob-b"></div>
  </div>

  <div class="md-shell">
    <header class="md-header">
      <div class="md-brand">
        <img src="{{ url_for('static', filename='Money_drop_logo.png') }}" alt="Money Drop" class="md-logo" />
      </div>

      <div class="md-header-right">
        <div class="md-pill">
          <span class="md-pill-label">Joueur:</span>
          <span id="playerName" class="md-pill-value">...</span>
        </div>
        <div class="md-pill" id="chipsDisplay" style="display:none;">
          <span class="md-pill-label">Jetons:</span>
          <span id="chips" class="md-pill-value md-gold">1000</span>
        </div>
        <div class="md-pill">
          <span class="md-pill-label">Lobby:</span>
          <span class="md-pill-value">{{ lobby_id }}</span>
        </div>
        <a href="/menu" class="md-btn md-btn-ghost">Menu</a>
      </div>
    </header>

    <!-- Ã‰cran d'attente du lobby -->
    <div id="lobbyWaiting" class="md-lobby-waiting">
      <div class="md-lobby-container">
        <div class="md-lobby-header">
          <h1 class="md-lobby-title">ðŸŽ® Salon d'attente</h1>
          <p class="md-lobby-subtitle">En attente du dÃ©marrage de la partie...</p>
        </div>

        <div class="md-lobby-players">
          <div class="md-lobby-players-title">
            <span class="md-star">â˜…</span>
            Joueurs connectÃ©s
            <span class="md-lobby-count" id="lobbyPlayerCount">0</span>
          </div>
          <div id="lobbyPlayersList" class="md-lobby-players-list"></div>
        </div>

        <div class="md-lobby-footer">
          <div class="md-lobby-hint">
            ðŸ’¡ L'hÃ´te va lancer la partie dans quelques instants...
          </div>
        </div>
      </div>
    </div>

    <!-- Plateau de jeu (cachÃ© au dÃ©but) -->
    <main id="gameBoard" class="md-layout" style="display:none;">
      <section class="md-main">
        <div class="md-question">
          <div class="md-qbadge">
            <div class="md-qbadge-top">Question</div>
            <div class="md-qbadge-num" id="qCounter">-</div>
          </div>

          <div class="md-qtext">
            <div id="category" class="md-qcategory">CatÃ©gorie</div>
            <div id="prompt" class="md-qprompt">En attente du serveur...</div>
          </div>

          <div class="md-timer" aria-label="Chrono">
            <svg class="md-timer-svg" viewBox="0 0 100 100" role="img">
              <circle class="md-timer-bg" cx="50" cy="50" r="45" />
              <circle id="timerProgress" class="md-timer-fg" cx="50" cy="50" r="45" />
            </svg>
            <div id="timerValue" class="md-timer-value">60</div>
          </div>
        </div>

        <div class="md-board">
          <!-- Answer cards -->
          <div class="md-answers" role="group" aria-label="RÃ©ponses">
            <div class="md-answer" data-key="A">
              <div class="md-answer-letter">A</div>
              <div id="ansA" class="md-answer-text">...</div>
              <div id="amountA" class="md-answer-amount">0 â‚¬</div>
            </div>
            <div class="md-answer" data-key="B">
              <div class="md-answer-letter">B</div>
              <div id="ansB" class="md-answer-text">...</div>
              <div id="amountB" class="md-answer-amount">0 â‚¬</div>
            </div>
            <div class="md-answer" data-key="C">
              <div class="md-answer-letter">C</div>
              <div id="ansC" class="md-answer-text">...</div>
              <div id="amountC" class="md-answer-amount">0 â‚¬</div>
            </div>
            <div class="md-answer" data-key="D">
              <div class="md-answer-letter">D</div>
              <div id="ansD" class="md-answer-text">...</div>
              <div id="amountD" class="md-answer-amount">0 â‚¬</div>
            </div>
          </div>

          <!-- Drop zones with +/- controls -->
          <div class="md-zones" role="group" aria-label="Zones de mise">
            <div class="md-zone" data-key="A">
              <div class="md-zone-controls">
                <button class="md-circle-btn md-circle-btn-minus" type="button" data-action="minus" data-key="A" aria-label="Retirer">âˆ’</button>
                <button class="md-circle-btn md-circle-btn-plus" type="button" data-action="plus" data-key="A" aria-label="Ajouter">+</button>
              </div>
              <div class="md-zone-stacks" id="chipsVisualA" aria-hidden="true"></div>
              <div class="md-zone-label" id="zoneLabelA">Glissez ici</div>
              <input id="betA" class="md-hidden" type="number" min="0" step="100" value="0" />
            </div>

            <div class="md-zone" data-key="B">
              <div class="md-zone-controls">
                <button class="md-circle-btn md-circle-btn-minus" type="button" data-action="minus" data-key="B" aria-label="Retirer">âˆ’</button>
                <button class="md-circle-btn md-circle-btn-plus" type="button" data-action="plus" data-key="B" aria-label="Ajouter">+</button>
              </div>
              <div class="md-zone-stacks" id="chipsVisualB" aria-hidden="true"></div>
              <div class="md-zone-label" id="zoneLabelB">Glissez ici</div>
              <input id="betB" class="md-hidden" type="number" min="0" step="100" value="0" />
            </div>

            <div class="md-zone" data-key="C">
              <div class="md-zone-controls">
                <button class="md-circle-btn md-circle-btn-minus" type="button" data-action="minus" data-key="C" aria-label="Retirer">âˆ’</button>
                <button class="md-circle-btn md-circle-btn-plus" type="button" data-action="plus" data-key="C" aria-label="Ajouter">+</button>
              </div>
              <div class="md-zone-stacks" id="chipsVisualC" aria-hidden="true"></div>
              <div class="md-zone-label" id="zoneLabelC">Glissez ici</div>
              <input id="betC" class="md-hidden" type="number" min="0" step="100" value="0" />
            </div>

            <div class="md-zone" data-key="D">
              <div class="md-zone-controls">
                <button class="md-circle-btn md-circle-btn-minus" type="button" data-action="minus" data-key="D" aria-label="Retirer">âˆ’</button>
                <button class="md-circle-btn md-circle-btn-plus" type="button" data-action="plus" data-key="D" aria-label="Ajouter">+</button>
              </div>
              <div class="md-zone-stacks" id="chipsVisualD" aria-hidden="true"></div>
              <div class="md-zone-label" id="zoneLabelD">Glissez ici</div>
              <input id="betD" class="md-hidden" type="number" min="0" step="100" value="0" />
            </div>
          </div>

          <!-- Remaining tokens bar -->
          <div class="md-money">
            <div class="md-money-title">Jetons restants Ã  placer</div>
            <div id="moneyStacks" class="md-money-stacks" aria-hidden="true"></div>
            <div class="md-money-bar">
              <div class="md-money-bar-track">
                <div id="remainingBar" class="md-money-bar-fill"></div>
              </div>
              <div class="md-money-bar-text"><span id="unbet">0</span> â‚¬ / <span id="totalChips">0</span> â‚¬</div>
            </div>
          </div>

          <!-- Controls -->
          <div class="md-controls">
            <div class="md-metric">
              <div class="md-metric-label">Total misÃ©</div>
              <div class="md-metric-value md-accent" id="totalBet">0</div>
              <div class="md-metric-unit">â‚¬</div>
            </div>

            <button id="submit" class="md-btn md-btn-primary" type="button">Valider la mise</button>

            <div class="md-metric">
              <div class="md-metric-label">Non misÃ©</div>
              <div class="md-metric-value md-gold" id="unbetValue">0</div>
              <div class="md-metric-unit">â‚¬</div>
            </div>
          </div>

          <div id="message" class="md-message" role="status" aria-live="polite"></div>
        </div>
      </section>

      <aside class="md-sidebar" aria-label="Classement">
        <div class="md-sidebar-title">
          <span class="md-star">â˜…</span>
          <span>Classement</span>
        </div>
        <div id="leaderboard" class="md-leaderboard"></div>
        <div id="leaderboardFooter" class="md-leaderboard-footer"></div>
      </aside>
    </main>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    window.LOBBY_ID = "{{ lobby_id }}";
    window.ROLE = "player";
    
    // Gestion des sessions multiples (pour tester avec plusieurs onglets)
    // Chaque onglet aura sa propre session
    (function(){
      const lobbyId = window.LOBBY_ID;
      const playerNameKey = `moneydrop_player_${lobbyId}`;
      
      // VÃ©rifier si c'est la premiÃ¨re visite ou non
      const storedName = localStorage.getItem(playerNameKey);
      
      if(!storedName){
        // Demander le nom du joueur
        const playerNum = Math.floor(Math.random() * 1000);
        const suggestedName = `Joueur${playerNum}`;
        const playerName = prompt(`Entrez votre nom (ou appuyez sur OK pour: ${suggestedName}):`, suggestedName);
        
        if(playerName){
          localStorage.setItem(playerNameKey, playerName);
          window.PLAYER_NAME = playerName;
        } else {
          window.PLAYER_NAME = suggestedName;
          localStorage.setItem(playerNameKey, suggestedName);
        }
      } else {
        window.PLAYER_NAME = storedName;
      }
    })();
  </script>
  <script src="{{ url_for('static', filename='lobby_client.js') }}"></script>
  <script src="{{ url_for('static', filename='cinematic.js') }}"></script>
  <script src="{{ url_for('static', filename='resolution.js') }}"></script>
</body>
</html>
